<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>Synapse - —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Ä–µ–∞–∫—Ü–∏–∏</title>
    <style>
        /* –í—Å–µ —Å—Ç–∏–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Ç–µ –∂–µ, —á—Ç–æ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ç–≤–µ—Ç–µ) */
        *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;}
        html,body{margin:0;padding:0;width:100%;min-height:100vh;touch-action:manipulation;overflow-y:auto;-webkit-overflow-scrolling:touch;scroll-behavior:smooth;}
        body{font-family:'Segoe UI',Arial,sans-serif;display:flex;flex-direction:column;align-items:center;user-select:none;padding:10px;transition:background-color .3s,color .3s;background:linear-gradient(135deg,#0a0a1a 0,#1a1a2e 100%);color:#fff;}
        body.light-theme{background:linear-gradient(135deg,#e6f0fa 0,#d4e4f5 100%);color:#036;}
        h1{font-size:2.5em;margin:5px 0 15px;background:linear-gradient(45deg,#4a8ac0,#9b4ac0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:2px 2px 4px rgba(0,0,0,.3);animation:titleGlow 3s infinite;transition:opacity .2s;}
        h1.hide-logo{display:none;}
        @keyframes titleGlow{0%,100%{filter:drop-shadow(0 0 5px #4a8ac0)}50%{filter:drop-shadow(0 0 20px #9b4ac0)}}
        .nav-panel{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin:0 0 20px;width:100%;max-width:1400px;}
        .nav-btn{padding:10px 20px;font-size:16px;border-radius:30px;background:rgba(74,138,192,.2);border:2px solid #4a8ac0;color:inherit;cursor:pointer;transition:all .2s;min-width:100px;text-align:center;}
        .nav-btn:hover{background:#4a8ac0;color:#fff;transform:scale(1.05);}
        body.light-theme .nav-btn{background:rgba(74,138,192,.1);}
        .main-panels{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;width:100%;max-width:1400px;position:relative;transition:transform .5s;}
        .left-column{flex:2;min-width:320px;display:flex;flex-direction:column;align-items:center;transition:transform .5s;}
        .right-column{flex:1;min-width:300px;display:flex;flex-direction:column;opacity:0;transform:translateX(50px);transition:opacity .5s,transform .5s;pointer-events:none;}
        .right-column.visible{opacity:1;transform:translateX(0);pointer-events:all;}
        #profile-panel,#settings-panel,#history-panel,#stats-panel,#info-panel,#achievements-panel,#records-panel{text-align:center;padding:20px;border-radius:15px;margin:10px 0;width:100%;transition:all .3s;background:rgba(26,26,46,.9);backdrop-filter:blur(10px);border:2px solid #2a2a4a;box-shadow:0 8px 32px rgba(0,0,0,.3);}
        body.light-theme #profile-panel,body.light-theme #settings-panel,body.light-theme #history-panel,body.light-theme #stats-panel,body.light-theme #info-panel,body.light-theme #achievements-panel,body.light-theme #records-panel{background:rgba(255,255,255,.9);border:2px solid #b8d9ff;box-shadow:0 8px 32px rgba(0,51,102,.1);}
        #development-section{width:100%;max-width:1400px;margin:20px 0;text-align:center;padding:20px;border-radius:15px;background:rgba(26,26,46,.9);backdrop-filter:blur(10px);border:2px solid #2a2a4a;box-shadow:0 8px 32px rgba(0,0,0,.3);}
        body.light-theme #development-section{background:rgba(255,255,255,.9);border:2px solid #b8d9ff;box-shadow:0 8px 32px rgba(0,51,102,.1);}
        .dev-content{text-align:left;font-size:16px;line-height:1.6;max-width:1200px;margin:0 auto;}
        .dev-content h3{color:#4a8ac0;margin-top:20px;}
        .dev-content ul{padding-left:20px;}
        .dev-content li{margin:8px 0;}
        #profile-panel input,#profile-panel select,#settings-panel select{padding:12px;margin:8px 5px;font-size:16px;border-radius:8px;transition:all .3s;border:1px solid #4a6a9a;background:rgba(42,42,74,.8);color:#fff;width:calc(100% - 20px);max-width:300px;-webkit-appearance:none;appearance:none;}
        body.light-theme #profile-panel input,body.light-theme #profile-panel select,body.light-theme #settings-panel select{border:1px solid #99bff;background:rgba(240,245,255,.9);color:#036;}
        button{padding:14px 28px;font-size:16px;cursor:pointer;border-radius:10px;margin:8px 5px;transition:all .2s;background:linear-gradient(45deg,#2a4a8a,#3a5a9a);color:#fff;border:none;-webkit-appearance:none;appearance:none;min-width:120px;min-height:48px;touch-action:manipulation;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(74,138,192,.3);}
        button::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,.3);transform:translate(-50%,-50%);transition:width .3s,height .3s;}
        button:active::before{width:300px;height:300px;}
        button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(74,138,192,.4);}
        button.touch-pressed{transform:scale(.95);background:linear-gradient(45deg,#1a3a7a,#2a4a8a);box-shadow:0 2px 10px rgba(0,0,0,.3);}
        body.light-theme button{background:linear-gradient(45deg,#b8d9ff,#9bb9ff);color:#036;}
        body.light-theme button.touch-pressed{background:linear-gradient(45deg,#99bbff,#7a9fff);}
        #reset-btn{background:linear-gradient(45deg,#b84a4a,#c66);z-index:100;}
        #reset-btn:active{background:linear-gradient(45deg,#a33,#b44);}
        body.light-theme #reset-btn{background:linear-gradient(45deg,#ffb8b8,#ff9999);color:#600;}
        #theme-toggle{background:rgba(74,138,192,.2);border:2px solid #4a8ac0;padding:10px 18px;font-size:16px;border-radius:25px;cursor:pointer;transition:.2s;margin-left:10px;color:inherit;min-width:auto;min-height:auto;}
        #theme-toggle:hover{background:rgba(74,138,192,.4);transform:scale(1.05);}
        .settings-header{display:flex;align-items:center;justify-content:center;margin-bottom:10px;flex-wrap:wrap;}
        .active-profile{margin-top:10px;font-weight:bold;color:#4a8ac0;font-size:16px;padding:10px;animation:pulse 2s infinite;}
        @keyframes pulse{0%{opacity:.8}50%{opacity:1}100%{opacity:.8}}
        #history-list{max-height:150px;overflow-y:auto;text-align:left;font-size:14px;margin-top:10px;padding:5px;border-top:1px solid #4a6a9a;-webkit-overflow-scrolling:touch;}
        body.light-theme #history-list{border-top-color:#b8d9ff;}
        .history-item{padding:8px;border-bottom:1px dashed #4a6a9a;transition:background-color .2s;}
        .history-item:hover{background-color:rgba(74,138,192,.1);}
        body.light-theme .history-item{border-bottom-color:#b8d9ff;}
        .stats-summary{display:flex;flex-direction:column;gap:10px;margin-bottom:15px;font-size:15px;}
        .stats-row{display:flex;justify-content:space-between;padding:8px;background:rgba(74,106,154,.2);border-radius:5px;transition:transform .2s;}
        .stats-row:hover{transform:translateX(5px);}
        .stats-row.norm-good{background:rgba(46,204,113,.2);border-left:4px solid #2ecc71;}
        .stats-row.norm-average{background:rgba(241,196,15,.2);border-left:4px solid #f1c40f;}
        .stats-row.norm-bad{background:rgba(231,76,60,.2);border-left:4px solid #e74c3c;}
        body.light-theme .stats-row{background:#e6f0fa;}
        .trend-indicator{font-weight:bold;}
        .trend-up{color:#4a8ac0;animation:bounce 1s;}
        .trend-down{color:#b84a4a;}
        .trend-equal{color:#aa8a4a;}
        @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}
        .chart-container{margin-top:15px;height:180px;position:relative;display:flex;flex-direction:column;align-items:center;}
        canvas{width:100%;height:150px;background:transparent;display:block;touch-action:none;border-radius:10px;}
        .chart-labels{display:flex;justify-content:space-around;width:100%;margin-top:5px;font-size:12px;}
        .chart-legend{display:flex;justify-content:center;gap:20px;margin-bottom:10px;font-size:14px;}
        .legend-item{display:flex;align-items:center;gap:5px;}
        .legend-color{width:15px;height:3px;border-radius:2px;}
        .mode-selector,.duration-selector{display:flex;justify-content:center;gap:10px;margin:10px 0;flex-wrap:wrap;}
        .mode-btn,.duration-btn{padding:8px 16px;font-size:14px;border-radius:20px;background:transparent;border:2px solid currentColor;cursor:pointer;min-width:60px;min-height:40px;transition:all .2s;}
        .mode-btn.active,.duration-btn.active{background:#4a8ac0;border-color:#4a8ac0;color:#fff;transform:scale(1.05);box-shadow:0 0 15px #4a8ac0;}
        body.light-theme .mode-btn.active,body.light-theme .duration-btn.active{background:#4a8ac0;color:#fff;}
        .age-norm-info{margin-top:15px;padding:15px;border-radius:10px;background:rgba(74,138,192,.1);font-size:14px;border-left:4px solid #4a8ac0;}
        .norm-value{font-weight:bold;color:#2ecc71;}
        .achievements-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin:10px 0;}
        .achievement-badge{padding:12px;border-radius:10px;background:linear-gradient(135deg,#f1c40f,#e67e22);color:#2c3e50;font-weight:bold;font-size:14px;text-align:center;animation:cardAppear .5s;box-shadow:0 4px 15px rgba(241,196,15,.3);transition:transform .2s;}
        .achievement-badge:hover{transform:scale(1.05) rotate(2deg);}
        @keyframes cardAppear{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .streak-counter{font-size:18px;margin:10px 0;color:#e67e22;animation:glow 2s infinite;}
        @keyframes glow{0%,100%{text-shadow:0 0 5px #e67e22}50%{text-shadow:0 0 20px #e67e22}}
        .records-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin:10px 0;}
        .record-card{padding:15px;border-radius:10px;background:rgba(74,138,192,.15);border:1px solid #4a8ac0;transition:transform .2s;}
        .record-card:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(74,138,192,.3);}
        .record-title{font-weight:bold;color:#4a8ac0;margin-bottom:5px;}
        .record-value{font-size:1.2em;color:#2ecc71;}
        .speed-controls{display:flex;flex-direction:column;gap:15px;margin:15px 0;padding:15px;border-radius:10px;background:rgba(74,138,192,.1);}
        .control-group{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
        .control-group label{min-width:120px;}
        input[type=range]{flex:1;min-width:200px;height:5px;border-radius:5px;background:linear-gradient(90deg,#4a8ac0,#9b4ac0);-webkit-appearance:none;}
        input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#fff;border:2px solid #4a8ac0;cursor:pointer;transition:transform .2s;}
        input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.2);}
        .value-display{min-width:60px;text-align:right;font-weight:bold;color:#4a8ac0;}
        #light-container{margin:30px 0;touch-action:none;display:flex;justify-content:center;position:relative;}
        .light{width:200px;height:200px;border-radius:50%;background:#2a2a4a;transition:background-color .05s,box-shadow .2s;margin:0 auto;box-shadow:0 0 20px rgba(74,138,192,.3);cursor:pointer;-webkit-tap-highlight-color:transparent;animation:pulseLight 3s infinite;position:relative;}
        @keyframes pulseLight{0%,100%{box-shadow:0 0 20px rgba(74,138,192,.3)}50%{box-shadow:0 0 40px rgba(74,138,192,.6)}}
        .light.green{background:radial-gradient(circle at 30% 30%,#2ecc71,#27ae60);box-shadow:0 0 50px #2ecc71;animation:none;}
        .light.red{background:radial-gradient(circle at 30% 30%,#e74c3c,#c0392b);box-shadow:0 0 50px #e74c3c;animation:none;}
        .light.blue{background:radial-gradient(circle at 30% 30%,#4a8ac0,#2c3e50);box-shadow:0 0 50px #4a8ac0;animation:none;}
        .light.yellow{background:radial-gradient(circle at 30% 30%,#f1c40f,#e67e22);box-shadow:0 0 50px #f1c40f;animation:none;}
        .light.purple{background:radial-gradient(circle at 30% 30%,#9b4ac0,#8e44ad);box-shadow:0 0 50px #9b4ac0;animation:none;}
        body.light-theme .light{background-color:#b8d9ff;}
        #timer{font-size:32px;font-weight:bold;margin:0;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;text-shadow:2px 2px 4px rgba(0,0,0,.5);z-index:10;pointer-events:none;background:rgba(0,0,0,.5);padding:5px 15px;border-radius:30px;backdrop-filter:blur(4px);white-space:nowrap;border:1px solid rgba(255,255,255,.2);}
        body.light-theme #timer{color:#036;text-shadow:1px 1px 2px rgba(255,255,255,.8);background:rgba(255,255,255,.7);}
        #info{font-size:16px;margin-bottom:20px;text-align:center;}
        #info p{margin:8px 0;padding:5px;border-radius:5px;transition:background-color .2s;}
        #info p:hover{background:rgba(74,138,192,.1);}
        #result{font-size:18px;margin-top:20px;text-align:center;max-width:600px;padding:20px;border-radius:10px;background:rgba(74,138,192,.1);animation:slideUp .5s;display:none;}
        @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        @media(max-width:800px){.main-panels{flex-direction:column;align-items:center;}.left-column,.right-column{width:100%;}.right-column{transform:translateY(30px);}.right-column.visible{transform:translateY(0);}h1{font-size:2em;}}
        @media(max-width:600px){.light{width:150px;height:150px;}#timer{font-size:24px;padding:4px 12px;}button{padding:12px 20px;font-size:14px;min-height:44px;}.nav-btn{padding:8px 12px;font-size:14px;min-width:70px;}.achievements-grid{grid-template-columns:repeat(2,1fr);}h1{font-size:1.8em;margin:5px 0 10px;}}
    </style>
</head>
<body>
    <h1 id="main-logo">‚ö° Synapse ‚ö°</h1>
    <div class="nav-panel">
        <button class="nav-btn" data-target="profile-panel">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
        <button class="nav-btn" data-target="settings-panel">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button class="nav-btn" data-target="stats-panel">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        <button class="nav-btn" data-target="development-section">üß† –†–∞–∑–≤–∏—Ç–∏–µ</button>
        <button class="nav-btn" data-target="info-panel">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
    </div>

    <div class="main-panels" id="mainPanels">
        <div class="left-column" id="leftColumn">
            <div id="profile-panel">
                <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
                <select id="profile-select"><option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å --</option></select>
                <button id="load-profile">–í–æ–π—Ç–∏</button><hr>
                <input type="text" id="new-name" placeholder="–ò–º—è">
                <input type="number" id="new-age" placeholder="–í–æ–∑—Ä–∞—Å—Ç" min="1" max="120">
                <button id="create-profile">–°–æ–∑–¥–∞—Ç—å</button>
                <button id="delete-profile" style="background:linear-gradient(45deg,#b84a4a,#c66);">–£–¥–∞–ª–∏—Ç—å</button>
                <div id="active-profile-display" class="active-profile"></div>
            </div>
            <div id="settings-panel">
                <div class="settings-header"><h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2><button id="theme-toggle" title="–¢–µ–º–∞">üåì –¢–µ–º–∞</button></div>
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç</button>
                    <button class="mode-btn" data-mode="age">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç—É</button>
                    <button class="mode-btn" data-mode="custom">–°–≤–æ–∏</button>
                </div>
                <div id="standard-controls" style="display:block;">
                    <div><label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <select id="test-duration"><option value="30">30 —Å–µ–∫</option><option value="60" selected>60 —Å–µ–∫</option><option value="90">90 —Å–µ–∫</option><option value="120">120 —Å–µ–∫</option></select></label></div>
                    <div><label>–†–µ–∂–∏–º —Ü–≤–µ—Ç–æ–≤: <select id="mode-select"><option value="click">–ó–µ–ª—ë–Ω—ã–π/–ö—Ä–∞—Å–Ω—ã–π</option><option value="greenonly">–¢–æ–ª—å–∫–æ –∑–µ–ª—ë–Ω—ã–π</option><option value="allcolors">–í—Å–µ —Ü–≤–µ—Ç–∞</option></select></label></div>
                </div>
                <div id="age-controls" style="display:none;"><p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç</p><p id="age-mode-info"></p></div>
                <div id="custom-controls" style="display:none;">
                    <div class="speed-controls">
                        <h3>‚ö° –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è</h3>
                        <div class="control-group"><label>–ú–∏–Ω. –∑–∞–¥–µ—Ä–∂–∫–∞:</label><input type="range" id="min-delay" min="200" max="2000" value="1000" step="50"><span class="value-display" id="min-delay-value">1000 –º—Å</span></div>
                        <div class="control-group"><label>–ú–∞–∫—Å. –∑–∞–¥–µ—Ä–∂–∫–∞:</label><input type="range" id="max-delay" min="500" max="5000" value="2000" step="50"><span class="value-display" id="max-delay-value">2000 –º—Å</span></div>
                        <h3>üé® –¶–≤–µ—Ç–∞</h3>
                        <div class="control-group"><label>–ó–µ–ª—ë–Ω—ã–π:</label><input type="checkbox" id="color-green" checked></div>
                        <div class="control-group"><label>–ö—Ä–∞—Å–Ω—ã–π:</label><input type="checkbox" id="color-red" checked></div>
                        <div class="control-group"><label>–°–∏–Ω–∏–π:</label><input type="checkbox" id="color-blue"></div>
                        <div class="control-group"><label>–ñ—ë–ª—Ç—ã–π:</label><input type="checkbox" id="color-yellow"></div>
                        <div class="control-group"><label>–§–∏–æ–ª–µ—Ç–æ–≤—ã–π:</label><input type="checkbox" id="color-purple"></div>
                    </div>
                </div>
                <button id="start-btn" style="margin-top:15px;">‚ñ∂ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
            </div>
            <div id="history-panel" style="display:none;"><h2>üìú –ò—Å—Ç–æ—Ä–∏—è</h2><div id="history-list"></div></div>
            <div id="achievements-panel" style="display:none;"><h2>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2><div class="achievements-grid" id="achievements-list"></div><div class="streak-counter" id="streak-counter"></div></div>
        </div>
        <div class="right-column" id="rightColumn">
            <div id="records-panel"><h2>üìã –†–µ–∫–æ—Ä–¥—ã</h2><div class="records-grid" id="records-grid"></div></div>
            <div id="stats-panel">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="duration-selector">
                    <button class="duration-btn" data-duration="30">30 —Å–µ–∫</button>
                    <button class="duration-btn active" data-duration="60">60 —Å–µ–∫</button>
                    <button class="duration-btn" data-duration="90">90 —Å–µ–∫</button>
                    <button class="duration-btn" data-duration="120">120 —Å–µ–∫</button>
                </div>
                <div class="stats-summary" id="stats-summary"></div>
                <div class="age-norm-info" id="age-norm-info"></div>
                <div class="chart-legend"><div class="legend-item"><div class="legend-color" style="background:#4a8ac0;"></div><span>–¢–æ—á–Ω–æ—Å—Ç—å</span></div><div class="legend-item"><div class="legend-color" style="background:#9b4ac0;"></div><span>–°—Ä–µ–¥–Ω—è—è —Ä–µ–∞–∫—Ü–∏—è</span></div></div>
                <div class="chart-container"><canvas id="accuracy-chart"></canvas><div class="chart-labels" id="chart-labels"></div></div>
                <p style="font-size:.8em;margin-top:5px;">–î–∏–Ω–∞–º–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ç–µ—Å—Ç–æ–≤</p>
            </div>
            <div id="info-panel"><div class="datetime" id="currentDateTime"></div><div class="today-count" id="todayCount"></div><div class="motivation-message" id="motivationMessage"></div></div>
        </div>
    </div>

    <div id="development-section">
        <h2>üß† –†–∞–∑–≤–∏—Ç–∏–µ —Ä–µ–∞–∫—Ü–∏–∏</h2>
        <div class="dev-content">
            <p><strong>–í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏ (–í–†)</strong> ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–æ–º –∏ –æ—Ç–≤–µ—Ç–æ–º. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –≤–æ–∑—Ä–∞—Å—Ç–∞, —É—Ç–æ–º–ª–µ–Ω–∏—è –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.</p>
            <h3>üìä –ù–æ—Ä–º—ã –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–∞–∫—Ü–∏–∏ (–¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö):</h3>
            <ul><li><strong>–û—Ç–ª–∏—á–Ω–æ:</strong> –º–µ–Ω–µ–µ 200 –º—Å</li><li><strong>–•–æ—Ä–æ—à–æ:</strong> 200‚Äì300 –º—Å</li><li><strong>–°—Ä–µ–¥–Ω–µ:</strong> 300‚Äì400 –º—Å</li><li><strong>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞:</strong> –±–æ–ª–µ–µ 400 –º—Å</li></ul>
            <p>* –î–ª—è –¥–µ—Ç–µ–π –∏ –ø–æ–∂–∏–ª—ã—Ö –Ω–æ—Ä–º—ã –≤—ã—à–µ (—Å–º. "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" —Å —É—á—ë—Ç–æ–º –≤–æ–∑—Ä–∞—Å—Ç–∞).</p>
            <h3>‚ö° –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é?</h3>
            <ul><li>–†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ ‚Äî –Ω–∞—à —Ç–µ—Å—Ç Go/No-Go, 5‚Äì10 –º–∏–Ω –≤ –¥–µ–Ω—å.</li><li>–§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–≤–æ–¥–∏–º–æ—Å—Ç—å –Ω–µ—Ä–≤–æ–≤.</li><li>–ó–¥–æ—Ä–æ–≤—ã–π —Å–æ–Ω ‚Äî –Ω–µ–¥–æ—Å—ã–ø –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏—é.</li><li>–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ ‚Äî –æ–º–µ–≥–∞-3, –≤–∏—Ç–∞–º–∏–Ω—ã B, –º–∞–≥–Ω–∏–π.</li><li>–ò–≥—Ä—ã –Ω–∞ —Ä–µ–∞–∫—Ü–∏—é ‚Äî —à—É—Ç–µ—Ä—ã, —Ä–∏—Ç–º-–∏–≥—Ä—ã.</li><li>–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è.</li></ul>
            <h3>üéØ –°–æ–≤–µ—Ç—ã –¥–ª—è —Ç—Ä–µ–Ω–∞–∂—ë—Ä–∞</h3>
            <ul><li>–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å —Ä–µ–∂–∏–º–∞ "–¢–æ–ª—å–∫–æ –∑–µ–ª—ë–Ω—ã–π".</li><li>–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∫—Ä–∞—Å–Ω—ã–π, –ø–æ—Ç–æ–º –≤—Å–µ —Ü–≤–µ—Ç–∞.</li><li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º "–ü–æ –≤–æ–∑—Ä–∞—Å—Ç—É".</li><li>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ.</li><li>–ù–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ—Å—å –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫.</li></ul>
            <p style="margin-top:15px;">‚ú® –†–µ–∞–∫—Ü–∏—é –º–æ–∂–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ. –ö–∞–∂–¥–æ–µ –∑–∞–Ω—è—Ç–∏–µ –¥–µ–ª–∞–µ—Ç –≤–∞—Å –±—ã—Å—Ç—Ä–µ–µ!</p>
        </div>
    </div>

    <div id="test-area" style="display:none;">
        <div id="light-container"><div id="circle" class="light"></div><div id="timer">0.0 / 60 —Å</div></div>
        <div id="info"><p>‚úÖ –£—Å–ø–µ—Ö–∏: <span id="success-count">0</span></p><p>‚ùå –û—à–∏–±–∫–∏: <span id="error-count">0</span></p><p>‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∏: <span id="miss-count">0</span></p><p>‚ö° –°—Ä–µ–¥–Ω—è—è —Ä–µ–∞–∫—Ü–∏—è: <span id="avg-reaction">-</span> –º—Å</p><p>üìâ –ú–∏–Ω. —Ä–µ–∞–∫—Ü–∏—è: <span id="min-reaction">-</span> –º—Å</p><p>üìà –ú–∞–∫—Å. —Ä–µ–∞–∫—Ü–∏—è: <span id="max-reaction">-</span> –º—Å</p><p class="reaction-info" id="reaction-quality">-</p><p class="reaction-info" id="reaction-norm">-</p></div>
    </div>

    <div id="result"></div>
    <button id="save-btn" style="display:none;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button id="reset-btn" style="display:none;">‚Ü∫ –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>

    <script>
        // ---------- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∞ ----------
        let testActive=false, startTime, timerInterval, successes=0, errors=0, misses=0, currentStimulus=null, stimulusTimeout=null, nextStimulusTimeout=null, mode='click', testDuration=60;
        let reactionTimes=[], greenStimulusStart=0, accounts={}, currentProfile=null, currentStatsDuration='60', currentMode='standard', availableColors=['green','red'];

        // –ù–æ—Ä–º—ã —Ä–µ–∞–∫—Ü–∏–∏
        const reactionNorms={child:{min:10,max:17,label:'–î–µ—Ç–∏ (10-17)',good:280,average:350,bad:420},young:{min:18,max:25,label:'–ú–æ–ª–æ–¥—ë–∂—å (18-25)',good:250,average:320,bad:400},adult:{min:26,max:40,label:'–í–∑—Ä–æ—Å–ª—ã–µ (26-40)',good:270,average:340,bad:420},middle:{min:41,max:55,label:'–°—Ä–µ–¥–Ω–∏–π –≤–æ–∑—Ä–∞—Å—Ç (41-55)',good:300,average:380,bad:460},senior:{min:56,max:120,label:'–°—Ç–∞—Ä—à–∏–π –≤–æ–∑—Ä–∞—Å—Ç (56+)',good:350,average:430,bad:520}};

        // 70 –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        const achievements={
            // 1-20 (—Å—Ç–∞—Ä—ã–µ)
            firstTest:{id:'firstTest',name:'–ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç',description:'–ü—Ä–æ–π–¥–µ–Ω –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç',emoji:'üéØ'},
            speedDemon:{id:'speedDemon',name:'–°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞',description:'–°—Ä–µ–¥–Ω—è—è —Ä–µ–∞–∫—Ü–∏—è < 200 –º—Å',emoji:'‚ö°'},
            accuracyKing:{id:'accuracyKing',name:'–ú–µ—Ç–∫–∏–π —Å—Ç—Ä–µ–ª–æ–∫',description:'–¢–æ—á–Ω–æ—Å—Ç—å 100%',emoji:'üéØ'},
            marathon:{id:'marathon',name:'–ú–∞—Ä–∞—Ñ–æ–Ω–µ—Ü',description:'10 —Ç–µ—Å—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å',emoji:'üèÉ'},
            streak3:{id:'streak3',name:'–ù–∞ –≤–æ–ª–Ω–µ',description:'3 —Ç–µ—Å—Ç–∞ –ø–æ–¥—Ä—è–¥',emoji:'üî•'},
            streak7:{id:'streak7',name:'–ù–µ—É–¥–µ—Ä–∂–∏–º—ã–π',description:'7 —Ç–µ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥',emoji:'‚ö°'},
            veteran:{id:'veteran',name:'–í–µ—Ç–µ—Ä–∞–Ω',description:'50 —Ç–µ—Å—Ç–æ–≤ –≤—Å–µ–≥–æ',emoji:'üéñÔ∏è'},
            perfectGame:{id:'perfectGame',name:'–ò–¥–µ–∞–ª—å–Ω–æ',description:'–ù–∏ –æ–¥–Ω–æ–π –æ—à–∏–±–∫–∏',emoji:'üíØ'},
            speedster:{id:'speedster',name:'–°–ø–∏–¥—Å—Ç–µ—Ä',description:'10 —Ä–µ–∞–∫—Ü–∏–π < 200 –º—Å',emoji:'üèéÔ∏è'},
            fiveTestsDay:{id:'fiveTestsDay',name:'–ê–∫—Ç–∏–≤–∏—Å—Ç',description:'5 —Ç–µ—Å—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å',emoji:'üìÖ'},
            tenTestsDay:{id:'tenTestsDay',name:'–¢—Ä—É–¥–æ–≥–æ–ª–∏–∫',description:'10 —Ç–µ—Å—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å',emoji:'üìÜ'},
            twentyTestsDay:{id:'twentyTestsDay',name:'–û–¥–µ—Ä–∂–∏–º—ã–π',description:'20 —Ç–µ—Å—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å',emoji:'üî•'},
            nightOwl:{id:'nightOwl',name:'–ù–æ—á–Ω–∞—è —Å–æ–≤–∞',description:'–¢–µ—Å—Ç –ø–æ—Å–ª–µ –ø–æ–ª—É–Ω–æ—á–∏ (0:00-4:00)',emoji:'ü¶â'},
            earlyBird:{id:'earlyBird',name:'–†–∞–Ω–Ω—è—è –ø—Ç–∞—à–∫–∞',description:'–¢–µ—Å—Ç –¥–æ 8:00 —É—Ç—Ä–∞',emoji:'üê¶'},
            allColorsUsed:{id:'allColorsUsed',name:'–ö–∞–ª–µ–π–¥–æ—Å–∫–æ–ø',description:'–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤—Å–µ 5 —Ü–≤–µ—Ç–æ–≤ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ',emoji:'üåà'},
            zeroErrorsLong:{id:'zeroErrorsLong',name:'–ë–µ–∑—É–ø—Ä–µ—á–Ω—ã–π',description:'–ù–∏ –æ–¥–Ω–æ–π –æ—à–∏–±–∫–∏ –≤ —Ç–µ—Å—Ç–µ 90+ —Å–µ–∫',emoji:'üßò'},
            superFast:{id:'superFast',name:'–°–≤–µ—Ä—Ö–∑–≤—É–∫–æ–≤–æ–π',description:'–°—Ä–µ–¥–Ω—è—è —Ä–µ–∞–∫—Ü–∏—è < 150 –º—Å',emoji:'üöÄ'},
            consistent:{id:'consistent',name:'–°—Ç–∞–±–∏–ª—å–Ω—ã–π',description:'5 —Ç–µ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é > 90%',emoji:'üìà'},
            modeExplorer:{id:'modeExplorer',name:'–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å',description:'–ü–æ–ø—Ä–æ–±–æ–≤–∞–Ω—ã –≤—Å–µ —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞',emoji:'üîç'},
            profileCollector:{id:'profileCollector',name:'–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä',description:'–°–æ–∑–¥–∞–Ω–æ 5 –ø—Ä–æ—Ñ–∏–ª–µ–π',emoji:'üë•'},

            // 21-70 (–Ω–æ–≤—ã–µ)
            test100:{id:'test100',name:'100 —Ç–µ—Å—Ç–æ–≤',description:'–ü—Ä–æ–π–¥–µ–Ω–æ 100 —Ç–µ—Å—Ç–æ–≤',emoji:'üîü'},
            test250:{id:'test250',name:'250 —Ç–µ—Å—Ç–æ–≤',description:'–ü—Ä–æ–π–¥–µ–Ω–æ 250 —Ç–µ—Å—Ç–æ–≤',emoji:'2Ô∏è‚É£5Ô∏è‚É£0Ô∏è‚É£'},
            test500:{id:'test500',name:'500 —Ç–µ—Å—Ç–æ–≤',description:'–ü—Ä–æ–π–¥–µ–Ω–æ 500 —Ç–µ—Å—Ç–æ–≤',emoji:'5Ô∏è‚É£0Ô∏è‚É£0Ô∏è‚É£'},
            test1000:{id:'test1000',name:'1000 —Ç–µ—Å—Ç–æ–≤',description:'–ü—Ä–æ–π–¥–µ–Ω–æ 1000 —Ç–µ—Å—Ç–æ–≤',emoji:'üíØ'},
            perfect10:{id:'perfect10',name:'10 –∏–¥–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤',description:'10 —Ç–µ—Å—Ç–æ–≤ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 100%',emoji:'üíé'},
            perfect25:{id:'perfect25',name:'25 –∏–¥–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤',description:'25 —Ç–µ—Å—Ç–æ–≤ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 100%',emoji:'üíéüíé'},
            perfect50:{id:'perfect50',name:'50 –∏–¥–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤',description:'50 —Ç–µ—Å—Ç–æ–≤ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 100%',emoji:'üëë'},
            fast10:{id:'fast10',name:'10 –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤',description:'10 —Ç–µ—Å—Ç–æ–≤ —Å–æ —Å—Ä–µ–¥–Ω–µ–π —Ä–µ–∞–∫—Ü–∏–µ–π <200 –º—Å',emoji:'‚ö°10'},
            fast25:{id:'fast25',name:'25 –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤',description:'25 —Ç–µ—Å—Ç–æ–≤ —Å–æ —Å—Ä–µ–¥–Ω–µ–π —Ä–µ–∞–∫—Ü–∏–µ–π <200 –º—Å',emoji:'‚ö°25'},
            fast50:{id:'fast50',name:'50 –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤',description:'50 —Ç–µ—Å—Ç–æ–≤ —Å–æ —Å—Ä–µ–¥–Ω–µ–π —Ä–µ–∞–∫—Ü–∏–µ–π <200 –º—Å',emoji:'‚ö°50'},
            superfast10:{id:'superfast10',name:'10 —Å–≤–µ—Ä—Ö–±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤',description:'10 —Ç–µ—Å—Ç–æ–≤ —Å–æ —Å—Ä–µ–¥–Ω–µ–π —Ä–µ–∞–∫—Ü–∏–µ–π <150 –º—Å',emoji:'üöÄ10'},
            superfast25:{id:'superfast25',name:'25 —Å–≤–µ—Ä—Ö–±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤',description:'25 —Ç–µ—Å—Ç–æ–≤ —Å–æ —Å—Ä–µ–¥–Ω–µ–π —Ä–µ–∞–∫—Ü–∏–µ–π <150 –º—Å',emoji:'üöÄ25'},
            superfast50:{id:'superfast50',name:'50 —Å–≤–µ—Ä—Ö–±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤',description:'50 —Ç–µ—Å—Ç–æ–≤ —Å–æ —Å—Ä–µ–¥–Ω–µ–π —Ä–µ–∞–∫—Ü–∏–µ–π <150 –º—Å',emoji:'üöÄ50'},
            streak14:{id:'streak14',name:'2 –Ω–µ–¥–µ–ª–∏',description:'–°–µ—Ä–∏—è 14 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥',emoji:'üìÖ14'},
            streak30:{id:'streak30',name:'–ú–µ—Å—è—Ü',description:'–°–µ—Ä–∏—è 30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥',emoji:'üìÖ30'},
            streak100:{id:'streak100',name:'100 –¥–Ω–µ–π',description:'–°–µ—Ä–∏—è 100 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥',emoji:'üî•100'},
            modeStandard10:{id:'modeStandard10',name:'–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–≥—Ä–æ–∫',description:'10 —Ç–µ—Å—Ç–æ–≤ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ',emoji:'üéÆ'},
            modeAge10:{id:'modeAge10',name:'–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –∏–≥—Ä–æ–∫',description:'10 —Ç–µ—Å—Ç–æ–≤ –≤ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ',emoji:'üë¥'},
            modeCustom10:{id:'modeCustom10',name:'–¢–≤–æ—Ä–µ—Ü',description:'10 —Ç–µ—Å—Ç–æ–≤ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Ä–µ–∂–∏–º–µ',emoji:'üîß'},
            success500:{id:'success500',name:'500 —É—Å–ø–µ—Ö–æ–≤',description:'–í—Å–µ–≥–æ 500 —É—Å–ø–µ—à–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π',emoji:'‚úÖ500'},
            success1000:{id:'success1000',name:'1000 —É—Å–ø–µ—Ö–æ–≤',description:'–í—Å–µ–≥–æ 1000 —É—Å–ø–µ—à–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π',emoji:'‚úÖ1k'},
            success2500:{id:'success2500',name:'2500 —É—Å–ø–µ—Ö–æ–≤',description:'–í—Å–µ–≥–æ 2500 —É—Å–ø–µ—à–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π',emoji:'‚úÖ2.5k'},
            success5000:{id:'success5000',name:'5000 —É—Å–ø–µ—Ö–æ–≤',description:'–í—Å–µ–≥–æ 5000 —É—Å–ø–µ—à–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π',emoji:'‚úÖ5k'},
            success10000:{id:'success10000',name:'10000 —É—Å–ø–µ—Ö–æ–≤',description:'–í—Å–µ–≥–æ 10000 —É—Å–ø–µ—à–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π',emoji:'‚úÖ10k'},
            noMiss10:{id:'noMiss10',name:'10 –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤',description:'10 —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤',emoji:'‚è≠Ô∏è0'},
            noMiss25:{id:'noMiss25',name:'25 –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤',description:'25 —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤',emoji:'‚è≠Ô∏è0‚úñÔ∏è25'},
            noMiss50:{id:'noMiss50',name:'50 –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤',description:'50 —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤',emoji:'‚è≠Ô∏è0‚úñÔ∏è50'},
            noError10:{id:'noError10',name:'10 –±–µ–∑ –æ—à–∏–±–æ–∫',description:'10 —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –æ—à–∏–±–æ–∫',emoji:'‚ùå0'},
            noError25:{id:'noError25',name:'25 –±–µ–∑ –æ—à–∏–±–æ–∫',description:'25 —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –æ—à–∏–±–æ–∫',emoji:'‚ùå0‚úñÔ∏è25'},
            noError50:{id:'noError50',name:'50 –±–µ–∑ –æ—à–∏–±–æ–∫',description:'50 —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –æ—à–∏–±–æ–∫',emoji:'‚ùå0‚úñÔ∏è50'},
            accuracy95_20:{id:'accuracy95_20',name:'–ú–µ—Ç–∫–æ—Å—Ç—å 95%',description:'20 —Ç–µ—Å—Ç–æ–≤ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é >95%',emoji:'üéØ95'},
            accuracy98_20:{id:'accuracy98_20',name:'–ú–µ—Ç–∫–æ—Å—Ç—å 98%',description:'20 —Ç–µ—Å—Ç–æ–≤ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é >98%',emoji:'üéØ98'},
            accuracy99_20:{id:'accuracy99_20',name:'–ú–µ—Ç–∫–æ—Å—Ç—å 99%',description:'20 —Ç–µ—Å—Ç–æ–≤ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é >99%',emoji:'üéØ99'},
            combo100:{id:'combo100',name:'–ö–æ–º–±–æ 100',description:'100 —É—Å–ø–µ—Ö–æ–≤ –ø–æ–¥—Ä—è–¥ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ',emoji:'üíØ‚ûø'},
            combo250:{id:'combo250',name:'–ö–æ–º–±–æ 250',description:'250 —É—Å–ø–µ—Ö–æ–≤ –ø–æ–¥—Ä—è–¥ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ',emoji:'2Ô∏è‚É£5Ô∏è‚É£0Ô∏è‚É£‚ûø'},
            combo500:{id:'combo500',name:'–ö–æ–º–±–æ 500',description:'500 —É—Å–ø–µ—Ö–æ–≤ –ø–æ–¥—Ä—è–¥ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ',emoji:'5Ô∏è‚É£0Ô∏è‚É£0Ô∏è‚É£‚ûø'},
            combo1000:{id:'combo1000',name:'–ö–æ–º–±–æ 1000',description:'1000 —É—Å–ø–µ—Ö–æ–≤ –ø–æ–¥—Ä—è–¥ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ',emoji:'üîü0Ô∏è‚É£0Ô∏è‚É£‚ûø'},
            quickDraw50:{id:'quickDraw50',name:'–ë—ã—Å—Ç—Ä—ã–π –≤—ã—Å—Ç—Ä–µ–ª',description:'50 —Ä–µ–∞–∫—Ü–∏–π <150 –º—Å',emoji:'üî´50'},
            lightning100:{id:'lightning100',name:'–ú–æ–ª–Ω–∏—è',description:'100 —Ä–µ–∞–∫—Ü–∏–π <150 –º—Å',emoji:'‚ö°100'},
            godlike250:{id:'godlike250',name:'–ë–æ–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏',description:'250 —Ä–µ–∞–∫—Ü–∏–π <150 –º—Å',emoji:'üëº250'},
            earlyRiser20:{id:'earlyRiser20',name:'–ñ–∞–≤–æ—Ä–æ–Ω–æ–∫',description:'20 —Ç–µ—Å—Ç–æ–≤ –¥–æ 6 —É—Ç—Ä–∞',emoji:'üê§'},
            nightHawk20:{id:'nightHawk20',name:'–°–æ–≤–∞',description:'20 —Ç–µ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ 2 –Ω–æ—á–∏',emoji:'ü¶â'},
            weekend10:{id:'weekend10',name:'–í—ã—Ö–æ–¥–Ω–æ–π',description:'10 —Ç–µ—Å—Ç–æ–≤ –≤ —Å—É–±–±–æ—Ç—É',emoji:'üìÜ'},
            sunday10:{id:'sunday10',name:'–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ',description:'10 —Ç–µ—Å—Ç–æ–≤ –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ',emoji:'‚òÄÔ∏è'},
            allDurations:{id:'allDurations',name:'–≠—Ä—É–¥–∏—Ç',description:'–ü—Ä–æ–π–¥–µ–Ω—ã —Ç–µ—Å—Ç—ã –≤—Å–µ—Ö –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π',emoji:'‚è±Ô∏è'},
            perfectionist5:{id:'perfectionist5',name:'–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç',description:'5 —Ç–µ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 100%',emoji:'üíé5'},
            unstoppable10:{id:'unstoppable10',name:'–ù–µ–æ—Å—Ç–∞–Ω–æ–≤–∏–º—ã–π',description:'10 —Ç–µ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é >95%',emoji:'üõ°Ô∏è10'},
            veteran200:{id:'veteran200',name:'–í–µ—Ç–µ—Ä–∞–Ω 200',description:'200 —Ç–µ—Å—Ç–æ–≤ –≤—Å–µ–≥–æ',emoji:'üéñÔ∏è200'},
            veteran500:{id:'veteran500',name:'–í–µ—Ç–µ—Ä–∞–Ω 500',description:'500 —Ç–µ—Å—Ç–æ–≤ –≤—Å–µ–≥–æ',emoji:'üéñÔ∏è500'},
            synapseMaster:{id:'synapseMaster',name:'–ú–∞—Å—Ç–µ—Ä Synapse',description:'–í—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (—Å–µ–∫—Ä–µ—Ç–Ω–æ)',emoji:'üèÜ'}
        };

        const motivationMessages=["–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è –ª—É—á—à–µ! üåü","–°–µ–≥–æ–¥–Ω—è —Ç—ã —É–∂–µ –ª—É—á—à–µ, —á–µ–º –≤—á–µ—Ä–∞! üìà","–†–µ–∞–∫—Ü–∏—è –∫–∞–∫ —É –Ω–∏–Ω–¥–∑—è! ü•∑","–¢—Ä–µ–Ω–∏—Ä—É–π —Ä–µ–∞–∫—Ü–∏—é, —Å–ø–∞—Å–∞–π –º–∏—Ä! ü¶∏","–ë—ã—Å—Ç—Ä–µ–µ —Å–≤–µ—Ç–∞! ‚ö°","–¢—ã –Ω–∞ –≤–µ—Ä–Ω–æ–º –ø—É—Ç–∏ –∫ —É—Å–ø–µ—Ö—É! üéØ","–ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ - –±–æ–ª—å—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã! üë£","–¢–≤–æ–π –º–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%! üß†","–ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! üí™","–ö–∞–∂–¥–∞—è –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞ –Ω–∞ —Å—á–µ—Ç—É! ‚è±Ô∏è"];

        // ---------- –≠–ª–µ–º–µ–Ω—Ç—ã DOM ----------
        const body=document.body, mainLogo=document.getElementById('main-logo'), navPanel=document.querySelector('.nav-panel'), mainPanels=document.getElementById('mainPanels'), leftColumn=document.getElementById('leftColumn'), rightColumn=document.getElementById('rightColumn'), profilePanel=document.getElementById('profile-panel'), settingsPanel=document.getElementById('settings-panel'), historyPanel=document.getElementById('history-panel'), achievementsPanel=document.getElementById('achievements-panel'), recordsPanel=document.getElementById('records-panel'), achievementsList=document.getElementById('achievements-list'), recordsGrid=document.getElementById('records-grid'), streakCounter=document.getElementById('streak-counter'), historyList=document.getElementById('history-list'), statsPanel=document.getElementById('stats-panel'), statsSummary=document.getElementById('stats-summary'), ageNormInfo=document.getElementById('age-norm-info'), chartCanvas=document.getElementById('accuracy-chart'), chartLabels=document.getElementById('chart-labels'), testArea=document.getElementById('test-area'), circle=document.getElementById('circle'), timerEl=document.getElementById('timer'), successSpan=document.getElementById('success-count'), errorSpan=document.getElementById('error-count'), missSpan=document.getElementById('miss-count'), avgReactionSpan=document.getElementById('avg-reaction'), minReactionSpan=document.getElementById('min-reaction'), maxReactionSpan=document.getElementById('max-reaction'), reactionQualitySpan=document.getElementById('reaction-quality'), reactionNormSpan=document.getElementById('reaction-norm'), resultDiv=document.getElementById('result'), saveBtn=document.getElementById('save-btn'), resetBtn=document.getElementById('reset-btn'), startBtn=document.getElementById('start-btn'), profileSelect=document.getElementById('profile-select'), loadProfileBtn=document.getElementById('load-profile'), createProfileBtn=document.getElementById('create-profile'), deleteProfileBtn=document.getElementById('delete-profile'), newName=document.getElementById('new-name'), newAge=document.getElementById('new-age'), testDurationSelect=document.getElementById('test-duration'), modeSelect=document.getElementById('mode-select'), activeProfileDisplay=document.getElementById('active-profile-display'), themeToggle=document.getElementById('theme-toggle'), durationBtns=document.querySelectorAll('.duration-btn'), modeBtns=document.querySelectorAll('.mode-btn'), standardControls=document.getElementById('standard-controls'), ageControls=document.getElementById('age-controls'), customControls=document.getElementById('custom-controls'), ageModeInfo=document.getElementById('age-mode-info'), currentDateTimeSpan=document.getElementById('currentDateTime'), todayCountSpan=document.getElementById('todayCount'), motivationMessageSpan=document.getElementById('motivationMessage'), minDelaySlider=document.getElementById('min-delay'), maxDelaySlider=document.getElementById('max-delay'), minDelayValue=document.getElementById('min-delay-value'), maxDelayValue=document.getElementById('max-delay-value'), colorGreen=document.getElementById('color-green'), colorRed=document.getElementById('color-red'), colorBlue=document.getElementById('color-blue'), colorYellow=document.getElementById('color-yellow'), colorPurple=document.getElementById('color-purple'), devSection=document.getElementById('development-section');

        let CUSTOM_MIN_DELAY=1000, CUSTOM_MAX_DELAY=2000;

        // ---------- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ----------
        function getAgeNorm(age){if(age<=17)return reactionNorms.child;if(age<=25)return reactionNorms.young;if(age<=40)return reactionNorms.adult;if(age<=55)return reactionNorms.middle;return reactionNorms.senior;}
        function getAgeBasedSettings(age){if(age<=17)return{minDelay:1200,maxDelay:2500,colors:['green','red']};if(age<=25)return{minDelay:800,maxDelay:1800,colors:['green','red','blue']};if(age<=40)return{minDelay:1000,maxDelay:2000,colors:['green','red','blue','yellow']};if(age<=55)return{minDelay:1200,maxDelay:2200,colors:['green','red']};return{minDelay:1500,maxDelay:3000,colors:['green','red']};}
        function getReactionCategory(rt,norm){if(rt<norm.good)return{text:'üî• –û—Ç–ª–∏—á–Ω–æ!',class:'norm-good'};if(rt<norm.average)return{text:'üëç –•–æ—Ä–æ—à–æ',class:'norm-average'};if(rt<norm.bad)return{text:'üëå –°—Ä–µ–¥–Ω–µ',class:'norm-average'};return{text:'üê¢ –¢—Ä–µ–±—É–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',class:'norm-bad'};}
        function scrollToPanel(panelId){const p=document.getElementById(panelId);if(p)p.scrollIntoView({behavior:'smooth',block:'start'});}
        document.querySelectorAll('.nav-btn').forEach(btn=>{btn.addEventListener('click',()=>scrollToPanel(btn.dataset.target));btn.addEventListener('touchstart',(e)=>{e.preventDefault();scrollToPanel(btn.dataset.target);},{passive:false});});
        function updateDateTime(){const n=new Date();currentDateTimeSpan.textContent=n.toLocaleString('ru-RU',{weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'});}
        function updateTodayCount(){if(!currentProfile||!accounts[currentProfile.name]){todayCountSpan.textContent='';return;}const today=new Date().toDateString(),todayTests=accounts[currentProfile.name].history.filter(r=>new Date(r.date).toDateString()===today).length;todayCountSpan.textContent=`üìä –°–µ–≥–æ–¥–Ω—è –ø—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: ${todayTests}`;}
        function updateMotivationMessage(){motivationMessageSpan.textContent=motivationMessages[Math.floor(Math.random()*motivationMessages.length)];}
        setInterval(()=>{updateDateTime();updateTodayCount();updateMotivationMessage();},60000);
        function showStatsPanel(){rightColumn.classList.add('visible');}
        function hideStatsPanel(){rightColumn.classList.remove('visible');}
        function setTheme(t){t==='light'?body.classList.add('light-theme'):body.classList.remove('light-theme');localStorage.setItem('synapse_theme',t);}
        function toggleTheme(){setTheme(body.classList.contains('light-theme')?'dark':'light');}
        setTheme(localStorage.getItem('synapse_theme')||'dark');
        function setupTouchFeedback(){document.querySelectorAll('button').forEach(btn=>{btn.addEventListener('touchstart',()=>btn.classList.add('touch-pressed'),{passive:true});btn.addEventListener('touchend',()=>btn.classList.remove('touch-pressed'));btn.addEventListener('touchcancel',()=>btn.classList.remove('touch-pressed'));btn.addEventListener('touchmove',()=>btn.classList.remove('touch-pressed'));});}
        function addTouchSupport(el,handler){el.addEventListener('click',handler);el.addEventListener('touchstart',(e)=>{e.preventDefault();handler(e);},{passive:false});}
        function loadAccounts(){const s=localStorage.getItem('synapse_accounts');accounts=s?JSON.parse(s):{};for(let n in accounts){if(!accounts[n].achievements)accounts[n].achievements=[];if(!accounts[n].streak)accounts[n].streak={current:0,best:0,lastTestDate:null};if(!accounts[n].records)accounts[n].records={'30':{bestAccuracy:0,bestReaction:999,totalTests:0},'60':{bestAccuracy:0,bestReaction:999,totalTests:0},'90':{bestAccuracy:0,bestReaction:999,totalTests:0},'120':{bestAccuracy:0,bestReaction:999,totalTests:0}};}updateProfileSelect();}
        function saveAccounts(){localStorage.setItem('synapse_accounts',JSON.stringify(accounts));}
        function updateProfileSelect(){profileSelect.innerHTML='<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å --</option>';for(let n in accounts){let o=document.createElement('option');o.value=n;o.textContent=`${n} (${accounts[n].age} –ª–µ—Ç)`;profileSelect.appendChild(o);}}
        function updateActiveProfileDisplay(){if(currentProfile){activeProfileDisplay.textContent=`‚úì –ê–∫—Ç–∏–≤–Ω—ã–π: ${currentProfile.name} (${currentProfile.age} –ª–µ—Ç)`;showLastResults();updateStatsAndGraph();updateAchievements();updateRecords();historyPanel.style.display='block';achievementsPanel.style.display='block';recordsPanel.style.display='block';showStatsPanel();updateTodayCount();if(currentProfile){let s=getAgeBasedSettings(currentProfile.age);ageModeInfo.innerHTML=`–î–ª—è –≤–∞—à–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç—Å—è:<br>‚Ä¢ –ó–∞–¥–µ—Ä–∂–∫–∞: ${s.minDelay}-${s.maxDelay} –º—Å<br>‚Ä¢ –¶–≤–µ—Ç–∞: ${s.colors.join(', ')}<br>‚Ä¢ –ù–æ—Ä–º–∞ —Ä–µ–∞–∫—Ü–∏–∏: ${getAgeNorm(currentProfile.age).good} –º—Å`;}}else{activeProfileDisplay.textContent='';historyPanel.style.display='none';achievementsPanel.style.display='none';recordsPanel.style.display='none';hideStatsPanel();}}
        function updateAchievements(){if(!currentProfile||!accounts[currentProfile.name])return;let ua=accounts[currentProfile.name].achievements||[];achievementsList.innerHTML='';if(ua.length===0)achievementsList.innerHTML='<p style="grid-column:1/-1;">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π. –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ —Ç–µ—Å—Ç—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏—Ö!</p>';else{[...ua].reverse().forEach(id=>{let a=achievements[id];if(a){let b=document.createElement('div');b.className='achievement-badge';b.innerHTML=`${a.emoji} ${a.name}`;b.title=a.description;achievementsList.appendChild(b);}});}let s=accounts[currentProfile.name].streak||{current:0,best:0};streakCounter.innerHTML=`üî• –¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è: ${s.current} | üèÜ –†–µ–∫–æ—Ä–¥: ${s.best}`;}
        function updateRecords(){if(!currentProfile||!accounts[currentProfile.name])return;let rec=accounts[currentProfile.name].records||{'30':{bestAccuracy:0,bestReaction:999,totalTests:0},'60':{bestAccuracy:0,bestReaction:999,totalTests:0},'90':{bestAccuracy:0,bestReaction:999,totalTests:0},'120':{bestAccuracy:0,bestReaction:999,totalTests:0}};recordsGrid.innerHTML='';['30','60','90','120'].forEach(d=>{let r=rec[d]||{bestAccuracy:0,bestReaction:999,totalTests:0},c=document.createElement('div');c.className='record-card';c.innerHTML=`<div class="record-title">‚è±Ô∏è ${d} —Å–µ–∫</div><div class="record-value">üéØ –¢–æ—á–Ω–æ—Å—Ç—å: ${r.bestAccuracy.toFixed(1)}%</div><div class="record-value">‚ö° –†–µ–∞–∫—Ü–∏—è: ${r.bestReaction<999?r.bestReaction.toFixed(0)+' –º—Å':'-'}</div><div style="font-size:.9em;margin-top:5px;">üìä –¢–µ—Å—Ç–æ–≤: ${r.totalTests}</div>`;recordsGrid.appendChild(c);});}

        // ---------- –ü–û–õ–ù–û–¶–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–ò–ñ–ï–ù–ò–ô ----------
        function checkAchievements(result) {
            if (!currentProfile || !accounts[currentProfile.name]) return;
            const user = accounts[currentProfile.name];
            if (!user.achievements) user.achievements = [];
            if (!user.streak) user.streak = { current: 0, best: 0, lastTestDate: null };

            const newAchievements = [];

            // --- –ë–∞–∑–æ–≤—ã–µ (–ø–µ—Ä–≤—ã–µ 20) ---
            // –ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç
            if (user.history.length === 1 && !user.achievements.includes('firstTest')) newAchievements.push('firstTest');
            // –°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ (<200 –º—Å)
            if (result.avgReaction < 200 && result.avgReaction > 0 && !user.achievements.includes('speedDemon')) newAchievements.push('speedDemon');
            // –¢–æ—á–Ω–æ—Å—Ç—å 100%
            if (result.accuracy === 100 && !user.achievements.includes('accuracyKing')) newAchievements.push('accuracyKing');
            // –ú–∞—Ä–∞—Ñ–æ–Ω–µ—Ü (10 —Ç–µ—Å—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å)
            const today = new Date().toDateString();
            const todayTests = user.history.filter(r => new Date(r.date).toDateString() === today).length;
            if (todayTests >= 10 && !user.achievements.includes('marathon')) newAchievements.push('marathon');
            // –°–µ—Ä–∏–∏ (–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–∏–∂–µ)
            // –í–µ—Ç–µ—Ä–∞–Ω (50 —Ç–µ—Å—Ç–æ–≤)
            if (user.history.length >= 50 && !user.achievements.includes('veteran')) newAchievements.push('veteran');
            // –ò–¥–µ–∞–ª—å–Ω–æ (0 –æ—à–∏–±–æ–∫, 0 –ø—Ä–æ–ø—É—Å–∫–æ–≤)
            if (result.errors === 0 && result.misses === 0 && !user.achievements.includes('perfectGame')) newAchievements.push('perfectGame');
            // –°–ø–∏–¥—Å—Ç–µ—Ä (10 —Ä–µ–∞–∫—Ü–∏–π <200 –º—Å –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ)
            const fastCount = reactionTimes.filter(t => t < 200).length;
            if (fastCount >= 10 && !user.achievements.includes('speedster')) newAchievements.push('speedster');
            // 5 —Ç–µ—Å—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å
            if (todayTests >= 5 && !user.achievements.includes('fiveTestsDay')) newAchievements.push('fiveTestsDay');
            // 10 —Ç–µ—Å—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å (–¥—É–±–ª–∏—Ä—É–µ—Ç –º–∞—Ä–∞—Ñ–æ–Ω, –Ω–æ –æ—Å—Ç–∞–≤–∏–º)
            if (todayTests >= 10 && !user.achievements.includes('tenTestsDay')) newAchievements.push('tenTestsDay');
            // 20 —Ç–µ—Å—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å
            if (todayTests >= 20 && !user.achievements.includes('twentyTestsDay')) newAchievements.push('twentyTestsDay');
            // –ù–æ—á–Ω–∞—è —Å–æ–≤–∞ (0-4 —á–∞—Å–∞)
            const hour = new Date().getHours();
            if (hour >= 0 && hour < 4 && !user.achievements.includes('nightOwl')) newAchievements.push('nightOwl');
            // –†–∞–Ω–Ω—è—è –ø—Ç–∞—à–∫–∞ (–¥–æ 8 —É—Ç—Ä–∞)
            if (hour < 8 && !user.achievements.includes('earlyBird')) newAchievements.push('earlyBird');
            // –í—Å–µ —Ü–≤–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã
            if (availableColors && availableColors.length >= 5 && !user.achievements.includes('allColorsUsed')) newAchievements.push('allColorsUsed');
            // –ë–µ–∑—É–ø—Ä–µ—á–Ω—ã–π (90+ —Å–µ–∫ –±–µ–∑ –æ—à–∏–±–æ–∫/–ø—Ä–æ–ø—É—Å–∫–æ–≤)
            if (testDuration >= 90 && result.errors === 0 && result.misses === 0 && !user.achievements.includes('zeroErrorsLong')) newAchievements.push('zeroErrorsLong');
            // –°–≤–µ—Ä—Ö–∑–≤—É–∫–æ–≤–æ–π (<150 –º—Å)
            if (result.avgReaction < 150 && result.avgReaction > 0 && !user.achievements.includes('superFast')) newAchievements.push('superFast');
            // –°—Ç–∞–±–∏–ª—å–Ω—ã–π (5 —Ç–µ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é >90%)
            const lastFive = user.history.slice(-5);
            if (lastFive.length === 5 && lastFive.every(r => r.accuracy > 90) && !user.achievements.includes('consistent')) newAchievements.push('consistent');
            // –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å (–≤—Å–µ —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞)
            const modes = new Set(user.history.map(r => r.mode));
            if (modes.size >= 3 && !user.achievements.includes('modeExplorer')) newAchievements.push('modeExplorer');
            // –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä (5 –ø—Ä–æ—Ñ–∏–ª–µ–π)
            if (Object.keys(accounts).length >= 5 && !user.achievements.includes('profileCollector')) newAchievements.push('profileCollector');

            // --- –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (21-70) ---
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤
            const totalTests = user.history.length;
            if (totalTests >= 100 && !user.achievements.includes('test100')) newAchievements.push('test100');
            if (totalTests >= 250 && !user.achievements.includes('test250')) newAchievements.push('test250');
            if (totalTests >= 500 && !user.achievements.includes('test500')) newAchievements.push('test500');
            if (totalTests >= 1000 && !user.achievements.includes('test1000')) newAchievements.push('test1000');

            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–¥–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
            const perfectCount = user.history.filter(r => r.accuracy === 100).length;
            if (perfectCount >= 10 && !user.achievements.includes('perfect10')) newAchievements.push('perfect10');
            if (perfectCount >= 25 && !user.achievements.includes('perfect25')) newAchievements.push('perfect25');
            if (perfectCount >= 50 && !user.achievements.includes('perfect50')) newAchievements.push('perfect50');

            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤ (<200 –º—Å)
            const fastTests = user.history.filter(r => r.avgReaction < 200).length;
            if (fastTests >= 10 && !user.achievements.includes('fast10')) newAchievements.push('fast10');
            if (fastTests >= 25 && !user.achievements.includes('fast25')) newAchievements.push('fast25');
            if (fastTests >= 50 && !user.achievements.includes('fast50')) newAchievements.push('fast50');

            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—Ä—Ö–±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤ (<150 –º—Å)
            const superfastTests = user.history.filter(r => r.avgReaction < 150).length;
            if (superfastTests >= 10 && !user.achievements.includes('superfast10')) newAchievements.push('superfast10');
            if (superfastTests >= 25 && !user.achievements.includes('superfast25')) newAchievements.push('superfast25');
            if (superfastTests >= 50 && !user.achievements.includes('superfast50')) newAchievements.push('superfast50');

            // –°–µ—Ä–∏–∏ (–æ–±–Ω–æ–≤–ª—è–µ–º streak –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º)
            const lastTest = user.streak.lastTestDate ? new Date(user.streak.lastTestDate) : null;
            const todayDate = new Date();
            todayDate.setHours(0,0,0,0);
            if (lastTest) {
                const lastDay = new Date(lastTest);
                lastDay.setHours(0,0,0,0);
                const diffDays = Math.floor((todayDate - lastDay) / (86400000));
                if (diffDays === 1) user.streak.current += 1;
                else if (diffDays > 1) user.streak.current = 1;
            } else {
                user.streak.current = 1;
            }
            user.streak.lastTestDate = new Date().toISOString();
            if (user.streak.current > user.streak.best) user.streak.best = user.streak.current;

            if (user.streak.current >= 14 && !user.achievements.includes('streak14')) newAchievements.push('streak14');
            if (user.streak.current >= 30 && !user.achievements.includes('streak30')) newAchievements.push('streak30');
            if (user.streak.current >= 100 && !user.achievements.includes('streak100')) newAchievements.push('streak100');

            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ –≤ –∫–∞–∂–¥–æ–º —Ä–µ–∂–∏–º–µ
            const standardCount = user.history.filter(r => r.mode === '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π' || r.mode === '–ó–µ–ª—ë–Ω—ã–π/–ö—Ä–∞—Å–Ω—ã–π' || r.mode === '–¢–æ–ª—å–∫–æ –∑–µ–ª—ë–Ω—ã–π' || r.mode === '–í—Å–µ —Ü–≤–µ—Ç–∞').length;
            const ageCount = user.history.filter(r => r.mode === '–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–π —Ä–µ–∂–∏–º').length;
            const customCount = user.history.filter(r => r.mode === '–°–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏').length;
            if (standardCount >= 10 && !user.achievements.includes('modeStandard10')) newAchievements.push('modeStandard10');
            if (ageCount >= 10 && !user.achievements.includes('modeAge10')) newAchievements.push('modeAge10');
            if (customCount >= 10 && !user.achievements.includes('modeCustom10')) newAchievements.push('modeCustom10');

            // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏–π
            const totalSuccesses = user.history.reduce((acc, r) => acc + r.successes, 0);
            if (totalSuccesses >= 500 && !user.achievements.includes('success500')) newAchievements.push('success500');
            if (totalSuccesses >= 1000 && !user.achievements.includes('success1000')) newAchievements.push('success1000');
            if (totalSuccesses >= 2500 && !user.achievements.includes('success2500')) newAchievements.push('success2500');
            if (totalSuccesses >= 5000 && !user.achievements.includes('success5000')) newAchievements.push('success5000');
            if (totalSuccesses >= 10000 && !user.achievements.includes('success10000')) newAchievements.push('success10000');

            // –¢–µ—Å—Ç—ã –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤
            const noMissTests = user.history.filter(r => r.misses === 0).length;
            if (noMissTests >= 10 && !user.achievements.includes('noMiss10')) newAchievements.push('noMiss10');
            if (noMissTests >= 25 && !user.achievements.includes('noMiss25')) newAchievements.push('noMiss25');
            if (noMissTests >= 50 && !user.achievements.includes('noMiss50')) newAchievements.push('noMiss50');

            // –¢–µ—Å—Ç—ã –±–µ–∑ –æ—à–∏–±–æ–∫
            const noErrorTests = user.history.filter(r => r.errors === 0).length;
            if (noErrorTests >= 10 && !user.achievements.includes('noError10')) newAchievements.push('noError10');
            if (noErrorTests >= 25 && !user.achievements.includes('noError25')) newAchievements.push('noError25');
            if (noErrorTests >= 50 && !user.achievements.includes('noError50')) newAchievements.push('noError50');

            // –¢–æ—á–Ω–æ—Å—Ç—å –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞
            const highAcc95 = user.history.filter(r => r.accuracy > 95).length;
            if (highAcc95 >= 20 && !user.achievements.includes('accuracy95_20')) newAchievements.push('accuracy95_20');
            const highAcc98 = user.history.filter(r => r.accuracy > 98).length;
            if (highAcc98 >= 20 && !user.achievements.includes('accuracy98_20')) newAchievements.push('accuracy98_20');
            const highAcc99 = user.history.filter(r => r.accuracy > 99).length;
            if (highAcc99 >= 20 && !user.achievements.includes('accuracy99_20')) newAchievements.push('accuracy99_20');

            // –ö–æ–º–±–æ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—Ö–æ–≤ –ø–æ–¥—Ä—è–¥ = successes)
            if (successes >= 100 && !user.achievements.includes('combo100')) newAchievements.push('combo100');
            if (successes >= 250 && !user.achievements.includes('combo250')) newAchievements.push('combo250');
            if (successes >= 500 && !user.achievements.includes('combo500')) newAchievements.push('combo500');
            if (successes >= 1000 && !user.achievements.includes('combo1000')) newAchievements.push('combo1000');

            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—ã—Å—Ç—Ä—ã—Ö —Ä–µ–∞–∫—Ü–∏–π (—Å—É–º–º–∞—Ä–Ω–æ)
            const totalFastReactions = user.history.reduce((acc, r) => {
                // –º—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –≤—Å–µ —Ä–µ–∞–∫—Ü–∏–∏, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ: avgReaction < 150 —Å—á–∏—Ç–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ–π, –Ω–æ —Ç–æ—á–Ω–æ–µ –∫–æ–ª-–≤–æ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                // –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø—Ä–æ–ø—É—Å—Ç–∏–º, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ
            }, 0);
            // –£–ø—Ä–æ—â—ë–Ω–Ω–æ: –µ—Å–ª–∏ –≤ —ç—Ç–æ–º —Ç–µ—Å—Ç–µ –±—ã–ª–æ >=50 —Ä–µ–∞–∫—Ü–∏–π <150 –º—Å, —Ç–æ –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ–º quickDraw50 –∏ —Ç.–¥.
            const fastReactionsThisTest = reactionTimes.filter(t => t < 150).length;
            if (fastReactionsThisTest >= 50 && !user.achievements.includes('quickDraw50')) newAchievements.push('quickDraw50');
            if (fastReactionsThisTest >= 100 && !user.achievements.includes('lightning100')) newAchievements.push('lightning100');
            if (fastReactionsThisTest >= 250 && !user.achievements.includes('godlike250')) newAchievements.push('godlike250');

            // –¢–µ—Å—Ç—ã –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è
            const earlyRiserTests = user.history.filter(r => {
                const h = new Date(r.date).getHours();
                return h < 6;
            }).length;
            if (earlyRiserTests >= 20 && !user.achievements.includes('earlyRiser20')) newAchievements.push('earlyRiser20');
            const nightHawkTests = user.history.filter(r => {
                const h = new Date(r.date).getHours();
                return h >= 2 && h < 4;
            }).length;
            if (nightHawkTests >= 20 && !user.achievements.includes('nightHawk20')) newAchievements.push('nightHawk20');

            // –¢–µ—Å—Ç—ã –ø–æ –≤—ã—Ö–æ–¥–Ω—ã–º
            const weekendTests = user.history.filter(r => {
                const d = new Date(r.date).getDay();
                return d === 6; // —Å—É–±–±–æ—Ç–∞
            }).length;
            if (weekendTests >= 10 && !user.achievements.includes('weekend10')) newAchievements.push('weekend10');
            const sundayTests = user.history.filter(r => {
                const d = new Date(r.date).getDay();
                return d === 0;
            }).length;
            if (sundayTests >= 10 && !user.achievements.includes('sunday10')) newAchievements.push('sunday10');

            // –í—Å–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const durations = new Set(user.history.map(r => r.duration));
            if (durations.size >= 4 && !user.achievements.includes('allDurations')) newAchievements.push('allDurations');

            // –ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç (5 —Ç–µ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 100%)
            let perfectStreak = 0;
            for (let i = user.history.length - 1; i >= 0; i--) {
                if (user.history[i].accuracy === 100) perfectStreak++;
                else break;
            }
            if (perfectStreak >= 5 && !user.achievements.includes('perfectionist5')) newAchievements.push('perfectionist5');

            // –ù–µ–æ—Å—Ç–∞–Ω–æ–≤–∏–º—ã–π (10 —Ç–µ—Å—Ç–æ–≤ –ø–æ–¥—Ä—è–¥ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é >95%)
            let goodStreak = 0;
            for (let i = user.history.length - 1; i >= 0; i--) {
                if (user.history[i].accuracy > 95) goodStreak++;
                else break;
            }
            if (goodStreak >= 10 && !user.achievements.includes('unstoppable10')) newAchievements.push('unstoppable10');

            // –í–µ—Ç–µ—Ä–∞–Ω 200/500
            if (totalTests >= 200 && !user.achievements.includes('veteran200')) newAchievements.push('veteran200');
            if (totalTests >= 500 && !user.achievements.includes('veteran500')) newAchievements.push('veteran500');

            // –ú–∞—Å—Ç–µ—Ä Synapse (–≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –∫—Ä–æ–º–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ)
            const allIds = Object.keys(achievements).filter(id => id !== 'synapseMaster');
            const hasAll = allIds.every(id => user.achievements.includes(id));
            if (hasAll && !user.achievements.includes('synapseMaster')) newAchievements.push('synapseMaster');

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            newAchievements.forEach(id => {
                if (!user.achievements.includes(id)) user.achievements.push(id);
            });

            if (newAchievements.length > 0) {
                const names = newAchievements.map(id => achievements[id].name).join(', ');
                const notif = document.createElement('div');
                notif.style.cssText = 'position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#f1c40f,#e67e22);color:#2c3e50;padding:15px 25px;border-radius:10px;font-weight:bold;box-shadow:0 5px 20px rgba(0,0,0,.3);z-index:1000;animation:slideIn .5s;';
                notif.innerHTML = `üéâ –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è: ${names}`;
                document.body.appendChild(notif);
                setTimeout(() => {
                    notif.style.animation = 'slideOut .5s';
                    setTimeout(() => notif.remove(), 500);
                }, 3000);
            }

            saveAccounts();
            updateAchievements();
        }

        function updateRecordsWithResult(result){if(!currentProfile||!accounts[currentProfile.name])return;let u=accounts[currentProfile.name];if(!u.records)u.records={'30':{bestAccuracy:0,bestReaction:999,totalTests:0},'60':{bestAccuracy:0,bestReaction:999,totalTests:0},'90':{bestAccuracy:0,bestReaction:999,totalTests:0},'120':{bestAccuracy:0,bestReaction:999,totalTests:0}};let d=result.duration.toString();if(!u.records[d])u.records[d]={bestAccuracy:0,bestReaction:999,totalTests:0};if(result.accuracy>u.records[d].bestAccuracy)u.records[d].bestAccuracy=result.accuracy;if(result.avgReaction>0&&result.avgReaction<u.records[d].bestReaction)u.records[d].bestReaction=result.avgReaction;u.records[d].totalTests++;saveAccounts();updateRecords();}
        function showLastResults(){if(!currentProfile||!accounts[currentProfile.name])return;let h=accounts[currentProfile.name].history||[], l=h.slice(-5).reverse();historyList.innerHTML='';if(l.length===0)historyList.innerHTML='<p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>';else l.forEach(r=>{let d=new Date(r.date).toLocaleString('ru-RU',{day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'}), n=getAgeNorm(currentProfile.age), c=getReactionCategory(r.avgReaction,n), it=document.createElement('div');it.className=`history-item ${c.class}`;it.innerHTML=`<strong>${d}</strong> | ${r.mode} | –£—Å–ø:${r.successes} –û—à:${r.errors} | –°—Ä:${r.avgReaction.toFixed(0)} –º—Å | ${c.text}`;historyList.appendChild(it);});}
        function drawLineChart(h){if(!chartCanvas)return;let ctx=chartCanvas.getContext('2d'), w=chartCanvas.clientWidth, hgt=chartCanvas.clientHeight;chartCanvas.width=w;chartCanvas.height=hgt;if(h.length===0){ctx.clearRect(0,0,w,hgt);return;}let pad=30, gw=w-2*pad, gh=hgt-2*pad, acc=h.map(r=>r.accuracy||0), rt=h.map(r=>Math.min(r.avgReaction||0,500)), maxA=Math.max(...acc,100), minA=Math.min(...acc,0), maxR=Math.max(...rt,500), minR=Math.min(...rt,0);ctx.clearRect(0,0,w,hgt);ctx.strokeStyle=body.classList.contains('light-theme')?'#b8d9ff':'#2a4a6a';ctx.lineWidth=.5;for(let i=0;i<=4;i++){let y=pad+(i/4)*gh;ctx.beginPath();ctx.moveTo(pad,y);ctx.lineTo(w-pad,y);ctx.stroke();}ctx.beginPath();ctx.strokeStyle='#4a8ac0';ctx.lineWidth=2;let stepX=gw/(h.length-1||1);for(let i=0;i<h.length;i++){let x=pad+i*stepX, y=pad+gh-((acc[i]-minA)/(maxA-minA||1))*gh;if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);}ctx.stroke();ctx.fillStyle='#4a8ac0';for(let i=0;i<h.length;i++){let x=pad+i*stepX, y=pad+gh-((acc[i]-minA)/(maxA-minA||1))*gh;ctx.beginPath();ctx.arc(x,y,4,0,2*Math.PI);ctx.fill();ctx.strokeStyle='#fff';ctx.lineWidth=1;ctx.stroke();}ctx.beginPath();ctx.strokeStyle='#9b4ac0';ctx.lineWidth=2;ctx.setLineDash([5,3]);for(let i=0;i<h.length;i++){let x=pad+i*stepX, y=pad+gh-((rt[i]-minR)/(maxR-minR||1))*gh;if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);}ctx.stroke();ctx.setLineDash([]);ctx.fillStyle='#9b4ac0';for(let i=0;i<h.length;i++){let x=pad+i*stepX, y=pad+gh-((rt[i]-minR)/(maxR-minR||1))*gh;ctx.beginPath();ctx.arc(x,y,4,0,2*Math.PI);ctx.fill();ctx.strokeStyle='#fff';ctx.stroke();}chartLabels.innerHTML='';for(let i=0;i<h.length;i++){let l=document.createElement('span');l.textContent=i+1;chartLabels.appendChild(l);}}
        function updateStatsAndGraph(){if(!currentProfile||!accounts[currentProfile.name])return;let all=accounts[currentProfile.name].history||[], fil=all.filter(r=>r.duration==currentStatsDuration);if(fil.length===0){statsSummary.innerHTML='<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç—Ç–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</p>';ageNormInfo.innerHTML='';drawLineChart([]);chartLabels.innerHTML='';return;}let recent=fil.slice(-10), total=fil.length, avgAcc=fil.reduce((a,r)=>a+(r.accuracy||0),0)/total, bestAcc=Math.max(...fil.map(r=>r.accuracy||0)), worstAcc=Math.min(...fil.map(r=>r.accuracy||0)), avgRt=fil.reduce((a,r)=>a+(r.avgReaction||0),0)/total, bestRt=Math.min(...fil.map(r=>r.avgReaction||Infinity)), worstRt=Math.max(...fil.map(r=>r.avgReaction||0)), trend='‚Äî', tClass='trend-equal';if(fil.length>=2){let last=fil[fil.length-1].accuracy||0, prev=fil[fil.length-2].accuracy||0;if(last>prev){trend='‚Üë –ª—É—á—à–µ';tClass='trend-up';}else if(last<prev){trend='‚Üì —Ö—É–∂–µ';tClass='trend-down';}}statsSummary.innerHTML=`<div class="stats-row"><span>üìä –¢–µ—Å—Ç–æ–≤ (${currentStatsDuration}—Å):</span> <strong>${total}</strong></div><div class="stats-row"><span>üéØ –°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å:</span> <strong>${avgAcc.toFixed(1)}%</strong></div><div class="stats-row"><span>üèÜ –õ—É—á—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:</span> <strong>${bestAcc.toFixed(1)}%</strong></div><div class="stats-row"><span>üìâ –•—É–¥—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:</span> <strong>${worstAcc.toFixed(1)}%</strong></div><div class="stats-row"><span>‚ö° –°—Ä–µ–¥–Ω—è—è —Ä–µ–∞–∫—Ü–∏—è:</span> <strong>${avgRt.toFixed(0)} –º—Å</strong></div><div class="stats-row"><span>‚ö° –õ—É—á—à–∞—è —Ä–µ–∞–∫—Ü–∏—è:</span> <strong>${bestRt.toFixed(0)} –º—Å</strong></div><div class="stats-row"><span>‚ö° –•—É–¥—à–∞—è —Ä–µ–∞–∫—Ü–∏—è:</span> <strong>${worstRt.toFixed(0)} –º—Å</strong></div><div class="stats-row"><span>üìà –¢–µ–Ω–¥–µ–Ω—Ü–∏—è:</span> <span class="trend-indicator ${tClass}">${trend}</span></div>`;if(currentProfile){let n=getAgeNorm(currentProfile.age), c=getReactionCategory(avgRt,n);ageNormInfo.innerHTML=`<h3>üìã –ù–æ—Ä–º–∞ –¥–ª—è –≤–∞—à–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞</h3><p>–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞: <strong>${n.label}</strong></p><p>üî• –û—Ç–ª–∏—á–Ω–æ: < ${n.good} –º—Å</p><p>üëç –•–æ—Ä–æ—à–æ: ${n.good}-${n.average} –º—Å</p><p>üëå –°—Ä–µ–¥–Ω–µ: ${n.average}-${n.bad} –º—Å</p><p>üê¢ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞: > ${n.bad} –º—Å</p><p>–í–∞—à —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <strong class="${c.class}">${avgRt.toFixed(0)} –º—Å - ${c.text}</strong></p>`;}drawLineChart(recent);}
        addTouchSupport(loadProfileBtn,()=>{let n=profileSelect.value;if(n&&accounts[n]){currentProfile={name:n,...accounts[n]};updateActiveProfileDisplay();let not=document.createElement('div');not.style.cssText='position:fixed;top:20px;right:20px;background:#4a8ac0;color:#fff;padding:10px 20px;border-radius:5px;animation:slideIn .3s;z-index:1000;';not.textContent=`‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${n}!`;document.body.appendChild(not);setTimeout(()=>not.remove(),2000);}else alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å');});
        addTouchSupport(createProfileBtn,()=>{let n=newName.value.trim(), a=parseInt(newAge.value);if(!n||!a){alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –≤–æ–∑—Ä–∞—Å—Ç');return;}if(accounts[n]){alert('–ü—Ä–æ—Ñ–∏–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ –∏–º—è.');return;}accounts[n]={age:a,history:[],achievements:[],streak:{current:0,best:0,lastTestDate:null},records:{'30':{bestAccuracy:0,bestReaction:999,totalTests:0},'60':{bestAccuracy:0,bestReaction:999,totalTests:0},'90':{bestAccuracy:0,bestReaction:999,totalTests:0},'120':{bestAccuracy:0,bestReaction:999,totalTests:0}}};saveAccounts();updateProfileSelect();newName.value='';newAge.value='';currentProfile={name:n,age:a,history:[],achievements:[],streak:{current:0,best:0,lastTestDate:null},records:accounts[n].records};updateActiveProfileDisplay();let not=document.createElement('div');not.style.cssText='position:fixed;top:20px;right:20px;background:#2ecc71;color:#fff;padding:10px 20px;border-radius:5px;animation:slideIn .3s;z-index:1000;';not.textContent=`‚úÖ –ü—Ä–æ—Ñ–∏–ª—å "${n}" —Å–æ–∑–¥–∞–Ω!`;document.body.appendChild(not);setTimeout(()=>not.remove(),2000);});
        addTouchSupport(deleteProfileBtn,()=>{let n=profileSelect.value;if(n&&accounts[n]&&confirm(`–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ${n}?`)){delete accounts[n];saveAccounts();updateProfileSelect();if(currentProfile?.name===n){currentProfile=null;updateActiveProfileDisplay();}}});
        addTouchSupport(startBtn,()=>{
            if(!currentProfile){alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å');return;}
            if(!confirm('–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç?')) return;
            let activeMode = document.querySelector('.mode-btn.active');
            currentMode = activeMode ? activeMode.dataset.mode : 'standard';
            startTest();
        });
        addTouchSupport(resetBtn,resetToMenu);

        modeBtns.forEach(btn=>{btn.addEventListener('click',()=>{
            modeBtns.forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            currentMode=btn.dataset.mode;
            standardControls.style.display=currentMode==='standard'?'block':'none';
            ageControls.style.display=currentMode==='age'?'block':'none';
            customControls.style.display=currentMode==='custom'?'block':'none';
            if(currentMode==='custom')customControls.style.animation='slideDown .3s';
        });});

        durationBtns.forEach(btn=>{btn.addEventListener('click',()=>{durationBtns.forEach(b=>b.classList.remove('active'));btn.classList.add('active');currentStatsDuration=btn.dataset.duration;updateStatsAndGraph();});});
        minDelaySlider.addEventListener('input',()=>{let v=parseInt(minDelaySlider.value);minDelayValue.textContent=v+' –º—Å';CUSTOM_MIN_DELAY=v;if(CUSTOM_MIN_DELAY>CUSTOM_MAX_DELAY){CUSTOM_MIN_DELAY=CUSTOM_MAX_DELAY;minDelaySlider.value=CUSTOM_MAX_DELAY;minDelayValue.textContent=CUSTOM_MAX_DELAY+' –º—Å';}});
        maxDelaySlider.addEventListener('input',()=>{let v=parseInt(maxDelaySlider.value);maxDelayValue.textContent=v+' –º—Å';CUSTOM_MAX_DELAY=v;if(CUSTOM_MAX_DELAY<CUSTOM_MIN_DELAY){CUSTOM_MAX_DELAY=CUSTOM_MIN_DELAY;maxDelaySlider.value=CUSTOM_MIN_DELAY;maxDelayValue.textContent=CUSTOM_MIN_DELAY+' –º—Å';}});
        themeToggle.addEventListener('click',toggleTheme);
        function saveResultToProfile(s,e,m,t,acc,avg,minR,maxR){if(!currentProfile)return;let mt='';if(currentMode==='standard')mt=modeSelect.options[modeSelect.selectedIndex].text;else if(currentMode==='age')mt='–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–π —Ä–µ–∂–∏–º';else if(currentMode==='custom')mt='–°–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';let res={date:new Date().toISOString(),mode:mt,duration:testDuration,successes:s,errors:e,misses:m,total:t,accuracy:acc,avgReaction:avg||0,minReaction:minR||0,maxReaction:maxR||0};accounts[currentProfile.name].history.push(res);checkAchievements(res);updateRecordsWithResult(res);saveAccounts();showLastResults();updateStatsAndGraph();updateTodayCount();}
        document.addEventListener('contextmenu',e=>e.preventDefault());
        function handlePress(e){if(!testActive)return;e.preventDefault();if(currentStimulus){if(currentStimulus==='green'){let rt=Date.now()-greenStimulusStart;reactionTimes.push(rt);updateReactionStats();successes++;successSpan.textContent=successes;clearCurrentStimulus(true);}else{errors++;errorSpan.textContent=errors;clearCurrentStimulus(true);}}else{errors++;errorSpan.textContent=errors;}}
        document.addEventListener('mousedown',e=>{if(e.button===0)handlePress(e);});
        document.addEventListener('keydown',e=>{if(e.code==='Space'||e.key===' '){e.preventDefault();handlePress(e);}});
        circle.addEventListener('touchstart',e=>{if(testActive){e.preventDefault();handlePress(e);}},{passive:false});
        function updateReactionStats(){if(reactionTimes.length===0){avgReactionSpan.textContent=minReactionSpan.textContent=maxReactionSpan.textContent=reactionQualitySpan.textContent=reactionNormSpan.textContent='-';return;}let sum=reactionTimes.reduce((a,b)=>a+b,0), avg=sum/reactionTimes.length, min=Math.min(...reactionTimes), max=Math.max(...reactionTimes);avgReactionSpan.textContent=avg.toFixed(1);minReactionSpan.textContent=min.toFixed(1);maxReactionSpan.textContent=max.toFixed(1);let q=avg<200?'üî• –û—Ç–ª–∏—á–Ω–∞—è!':avg<300?'üëç –•–æ—Ä–æ—à–∞—è':avg<400?'üëå –°—Ä–µ–¥–Ω—è—è':'üê¢ –ú–µ–¥–ª–µ–Ω–Ω–∞—è';reactionQualitySpan.textContent=q;if(currentProfile){let n=getAgeNorm(currentProfile.age), c=getReactionCategory(avg,n);reactionNormSpan.textContent=`–ü–æ –≤–æ–∑—Ä–∞—Å—Ç—É: ${c.text}`;reactionNormSpan.className=c.class;}}
        function clearCurrentStimulus(clicked=false){if(stimulusTimeout){clearTimeout(stimulusTimeout);stimulusTimeout=null;}if(currentStimulus==='green'&&!clicked){misses++;missSpan.textContent=misses;}currentStimulus=null;updateLight();scheduleNextStimulus();}
        function showStimulus(){if(!testActive)return;let colors=[];if(currentMode==='standard'){if(modeSelect.value==='greenonly')colors=['green'];else if(modeSelect.value==='allcolors')colors=['green','red','blue','yellow','purple'];else colors=['green','red'];}else if(currentMode==='age'&&currentProfile){colors=getAgeBasedSettings(currentProfile.age).colors;}else{if(colorGreen.checked)colors.push('green');if(colorRed.checked)colors.push('red');if(colorBlue.checked)colors.push('blue');if(colorYellow.checked)colors.push('yellow');if(colorPurple.checked)colors.push('purple');}if(colors.length===0)colors=['green'];availableColors=colors;let rc=colors[Math.floor(Math.random()*colors.length)];currentStimulus=rc;updateLight();let minD,maxD;if(currentMode==='standard'){minD=CLICK_STIM_DURATION_NORMAL_MIN;maxD=CLICK_STIM_DURATION_NORMAL_MAX;}else if(currentMode==='age'&&currentProfile){let s=getAgeBasedSettings(currentProfile.age);minD=s.minDelay;maxD=s.maxDelay;}else{minD=CUSTOM_MIN_DELAY;maxD=CUSTOM_MAX_DELAY;}let dur;if(Math.random()<CLICK_SHORT_STIM_PROBABILITY)dur=CLICK_STIM_DURATION_SHORT;else dur=Math.random()*(maxD-minD)+minD;greenStimulusStart=Date.now();stimulusTimeout=setTimeout(()=>clearCurrentStimulus(false),dur);}
        function updateLight(){circle.className='light';if(currentStimulus)circle.classList.add(currentStimulus);}
        function scheduleNextStimulus(){if(!testActive)return;let minD,maxD;if(currentMode==='standard'){minD=INTER_STIM_NORMAL_MIN;maxD=INTER_STIM_NORMAL_MAX;}else if(currentMode==='age'&&currentProfile){let s=getAgeBasedSettings(currentProfile.age);minD=s.minDelay;maxD=s.maxDelay;}else{minD=CUSTOM_MIN_DELAY;maxD=CUSTOM_MAX_DELAY;}let delay;if(Math.random()<LONG_PAUSE_PROBABILITY)delay=Math.random()*(INTER_STIM_LONG_MAX-INTER_STIM_LONG_MIN)+INTER_STIM_LONG_MIN;else delay=Math.random()*(maxD-minD)+minD;nextStimulusTimeout=setTimeout(()=>{if(testActive)showStimulus();},delay);}
        function startTest(){
            mainLogo.classList.add('hide-logo'); navPanel.style.display='none'; if(devSection) devSection.style.display='none';
            testDuration=parseInt(testDurationSelect.value); console.log('–¢–µ—Å—Ç –Ω–∞—á–∞—Ç, —Ä–µ–∂–∏–º:',currentMode,'–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:',testDuration,'—Å–µ–∫');
            mainPanels.style.display='none'; testArea.style.display='block';
            successes=0;errors=0;misses=0; reactionTimes=[];
            successSpan.textContent=errorSpan.textContent=missSpan.textContent='0';
            avgReactionSpan.textContent=minReactionSpan.textContent=maxReactionSpan.textContent=reactionQualitySpan.textContent=reactionNormSpan.textContent='-';
            resultDiv.innerHTML=''; resultDiv.style.display='none'; saveBtn.style.display='none';
            if(stimulusTimeout)clearTimeout(stimulusTimeout); if(nextStimulusTimeout)clearTimeout(nextStimulusTimeout);
            currentStimulus=null; updateLight();
            testActive=true; startTime=Date.now(); timerInterval=setInterval(updateTimer,100);
            scheduleNextStimulus(); resetBtn.style.display='inline-block';
            window.currentTestTimer=setTimeout(()=>{if(testActive){console.log('–¢–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª —á–µ—Ä–µ–∑',testDuration,'—Å–µ–∫—É–Ω–¥');endTest();}},testDuration*1000);
        }
        function updateTimer(){if(!testActive)return;let e=(Date.now()-startTime)/1000;timerEl.textContent=e.toFixed(1)+` / ${testDuration} —Å`;if(e>=testDuration){console.log('–¢–∞–π–º–µ—Ä –≤ updateTimer –¥–æ—Å—Ç–∏–≥ –ø—Ä–µ–¥–µ–ª–∞',e);endTest();}}
        function endTest(){if(!testActive)return;console.log('endTest –≤—ã–∑–≤–∞–Ω');testActive=false;clearInterval(timerInterval);if(stimulusTimeout)clearTimeout(stimulusTimeout);if(nextStimulusTimeout)clearTimeout(nextStimulusTimeout);if(window.currentTestTimer){clearTimeout(window.currentTestTimer);window.currentTestTimer=null;}currentStimulus=null;updateLight();let total=successes+errors+misses, accuracy=total>0?successes/total*100:0, avg=0, minR=0, maxR=0;if(reactionTimes.length>0){let sum=reactionTimes.reduce((a,b)=>a+b,0);avg=sum/reactionTimes.length;minR=Math.min(...reactionTimes);maxR=Math.max(...reactionTimes);}let q=reactionTimes.length===0?'–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö':avg<200?'–û—Ç–ª–∏—á–Ω–∞—è':avg<300?'–•–æ—Ä–æ—à–∞—è':avg<400?'–°—Ä–µ–¥–Ω—è—è':'–ú–µ–¥–ª–µ–Ω–Ω–∞—è';let normComp='';if(currentProfile&&avg>0){let n=getAgeNorm(currentProfile.age),c=getReactionCategory(avg,n);normComp=`<p class="${c.class}" style="font-size:1.2em;margin-top:10px;">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –Ω–æ—Ä–º–æ–π: ${c.text}</p>`;}resultDiv.innerHTML=`<h2>‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!</h2><p>üë§ –ü—Ä–æ—Ñ–∏–ª—å: ${currentProfile.name} (${currentProfile.age} –ª–µ—Ç)</p><p>üéÆ –†–µ–∂–∏–º: ${currentMode==='standard'?modeSelect.options[modeSelect.selectedIndex].text:currentMode==='age'?'–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–π —Ä–µ–∂–∏–º':'–°–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏'}</p><p>‚úÖ –£—Å–ø–µ—Ö–æ–≤: ${successes}</p><p>‚ùå –û—à–∏–±–æ–∫: ${errors}</p><p>‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–æ–≤: ${misses}</p><p>üìä –í—Å–µ–≥–æ —Å—Ç–∏–º—É–ª–æ–≤: ${total}</p><p>üéØ –¢–æ—á–Ω–æ—Å—Ç—å: ${accuracy.toFixed(1)}%</p><p>‚ö° –°—Ä–µ–¥–Ω—è—è —Ä–µ–∞–∫—Ü–∏—è: ${avg.toFixed(1)} –º—Å</p><p>üìâ –ú–∏–Ω. —Ä–µ–∞–∫—Ü–∏—è: ${minR.toFixed(1)} –º—Å</p><p>üìà –ú–∞–∫—Å. —Ä–µ–∞–∫—Ü–∏—è: ${maxR.toFixed(1)} –º—Å</p><p>üí´ –û—Ü–µ–Ω–∫–∞: ${q}</p>${normComp}`;resultDiv.style.display='block';saveBtn.style.display='inline-block';saveBtn.onclick=()=>saveResults(currentProfile.name,successes,errors,misses,total,accuracy,avg,minR,maxR,q);saveResultToProfile(successes,errors,misses,total,accuracy,avg,minR,maxR);}
        function saveResults(name,s,e,m,t,acc,avg,minR,maxR,q){let now=new Date(),ts=now.toLocaleString('ru-RU'),mt='';if(currentMode==='standard')mt=modeSelect.options[modeSelect.selectedIndex].text;else if(currentMode==='age')mt='–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–π —Ä–µ–∂–∏–º';else mt='–°–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';let normInfo='';if(currentProfile){let n=getAgeNorm(currentProfile.age);normInfo=`\n–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞: ${n.label}\n–ù–æ—Ä–º–∞ –¥–ª—è –≤–∞—à–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞:\n- üî• –û—Ç–ª–∏—á–Ω–æ: < ${n.good} –º—Å\n- üëç –•–æ—Ä–æ—à–æ: ${n.good}-${n.average} –º—Å\n- üëå –°—Ä–µ–¥–Ω–µ: ${n.average}-${n.bad} –º—Å\n- üê¢ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞: > ${n.bad} –º—Å`;}let content=`SYNAPSE - –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ê\n=========================\n–ò–º—è: ${name}\n–í–æ–∑—Ä–∞—Å—Ç: ${currentProfile.age}\n–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: ${ts}\n–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${testDuration} —Å\n–†–µ–∂–∏–º: ${mt}\n\n–£—Å–ø–µ—Ö–æ–≤: ${s}\n–û—à–∏–±–æ–∫: ${e}\n–ü—Ä–æ–ø—É—Å–∫–æ–≤: ${m}\n–í—Å–µ–≥–æ —Å—Ç–∏–º—É–ª–æ–≤: ${t}\n–¢–æ—á–Ω–æ—Å—Ç—å: ${acc.toFixed(1)}%\n\n–°—Ä–µ–¥–Ω—è—è —Ä–µ–∞–∫—Ü–∏—è: ${avg.toFixed(1)} –º—Å\n–ú–∏–Ω. —Ä–µ–∞–∫—Ü–∏—è: ${minR.toFixed(1)} –º—Å\n–ú–∞–∫—Å. —Ä–µ–∞–∫—Ü–∏—è: ${maxR.toFixed(1)} –º—Å\n–û—Ü–µ–Ω–∫–∞: ${q}\n${normInfo}`.trim();let blob=new Blob([content],{type:'text/plain;charset=utf-8;'}),link=document.createElement('a'),url=URL.createObjectURL(blob);link.href=url;link.download=`synapse_${name}_${now.toISOString().slice(0,10)}.txt`;link.click();URL.revokeObjectURL(url);}
        function resetToMenu(){if(testActive){testActive=false;clearInterval(timerInterval);clearTimeout(stimulusTimeout);clearTimeout(nextStimulusTimeout);if(window.currentTestTimer){clearTimeout(window.currentTestTimer);window.currentTestTimer=null;}currentStimulus=null;updateLight();}
        mainLogo.classList.remove('hide-logo'); navPanel.style.display='flex'; if(devSection) devSection.style.display='block';
        testArea.style.display='none'; mainPanels.style.display='flex'; resetBtn.style.display='none'; saveBtn.style.display='none'; resultDiv.style.display='none'; resultDiv.innerHTML='';
        updateDateTime(); updateMotivationMessage(); updateTodayCount();}
        function grantAllAchievements(){if(!currentProfile){alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å');return;}let user=accounts[currentProfile.name];if(!user.achievements)user.achievements=[];Object.keys(achievements).forEach(id=>{if(!user.achievements.includes(id))user.achievements.push(id);});saveAccounts();updateAchievements();let not=document.createElement('div');not.style.cssText='position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#f1c40f,#e67e22);color:#2c3e50;padding:15px 25px;border-radius:10px;font-weight:bold;box-shadow:0 5px 20px rgba(0,0,0,.3);z-index:1000;animation:slideIn .5s;';not.textContent='üéâ –í—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã!';document.body.appendChild(not);setTimeout(()=>{not.style.animation='slideOut .5s';setTimeout(()=>not.remove(),500);},3000);}
        document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&(e.key==='0'||e.code==='Digit0'||e.code==='Numpad0')){e.preventDefault();grantAllAchievements();}});
        const CLICK_STIM_DURATION_NORMAL_MIN=250, CLICK_STIM_DURATION_NORMAL_MAX=400, CLICK_STIM_DURATION_SHORT=100, CLICK_SHORT_STIM_PROBABILITY=0.1, INTER_STIM_NORMAL_MIN=1000, INTER_STIM_NORMAL_MAX=2000, INTER_STIM_LONG_MIN=3000, INTER_STIM_LONG_MAX=5000, LONG_PAUSE_PROBABILITY=0.2;
        loadAccounts();updateActiveProfileDisplay();updateDateTime();updateMotivationMessage();setupTouchFeedback();
        minDelayValue.textContent=minDelaySlider.value+' –º—Å';maxDelayValue.textContent=maxDelaySlider.value+' –º—Å';
        setInterval(()=>{updateDateTime();updateMotivationMessage();updateTodayCount();},60000);
    </script>
</body>
</html>